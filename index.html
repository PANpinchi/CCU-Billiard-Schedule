<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
    <link rel="stylesheet" href="css/billiard.css">
    <title>CCU Billiard</title>
</head>
<body>
    <div id="app">
        <div class="container">
            <div style="height: 10vh;"></div>
            <div class="row">
                <div class="col-4">

                </div>
                <div class="col-4" style="text-align: center;">
                    <h1><strong>請輸入參賽者名稱</strong></h1>
                    <div style="height: 2vh;"></div>
                    <input type="text" v-model="player_name" v-on:keyup.enter="onEnter">
                    <div style="height: 4vh;"></div>
                    <ol class="list-group list-group-numbered" style="text-align: left;">
                        <li class="list-group-item" :class="[item.arrColor]" v-for="item in registered" style="font-size: 25px;">
                            <span :class="[item.arrColor]" style="font-size: 25px;"><strong>{{item.name}}</strong></span>
                            <button type="button" class="btn btn-danger" style="float: right" v-if="item.confirm" v-on:click.prevent="remove_item(item)">刪除</button>
                            <button type="button" class="btn btn-success" style="float: right; margin-right: 10px;" v-if="item.confirm" v-on:click.prevent="confirm_item(item)">確認</button>
                            <button type="button" class="btn btn-secondary" style="float: right;" v-else v-on:click.prevent="confirm_item(item)">取消</button>
                        </li>
                    </ol>
                </div>
                <div class="col-4" style="text-align: center;">
                    <h2><strong>賽程表產生器</strong></h2>
                    <hr>
                    <button type="button" class="btn btn-primary" v-on:click.prevent="submit">產生賽程表</button>
                </div>
            </div>
        </div>
    </div>
</body>
</html>

<script>
    var app = new Vue({
        el: '#app',
        data: {
            player_name: '',
            registered: []
        },
        methods: {
            onEnter: function(){
                if(this.player_name != ''){
                    if(this.registered.length == 16){
                        alert("已達上限人數 16 人 !");
                        this.player_name = '';
                    }
                    else if (this.player_name.length > 10) {
                        alert("名字不可超過10個字元 !");
                        this.player_name = '';
                    }
                    else{
                        this.registered.push({name: this.player_name, arrColor: 'black', confirm: true});
                        this.player_name = '';
                    }
                }
            },

            remove_item: function(item){
                this.registered.splice(this.registered.indexOf(item), 1);
            },

            confirm_item: function(item){
                var index = this.registered.indexOf(item);
                this.registered[index].arrColor = this.registered[index].arrColor === 'black' ? 'green' : 'black';
                this.registered[index].confirm = this.registered[index].confirm === true ? false : true;
            },

            submit: function(){
                var check_confirm = 1;
                for(var i = 0; i < this.registered.length; i++){
                    if(this.registered[i].confirm == true){
                        check_confirm = 0;
                        break;
                    }
                }

                if(this.registered.length <= 1){
                    alert("請輸入2位以上的參賽者 !");
                }
                else if(check_confirm){
                    $.ajax({
                        url : "schedule.html",
                        type: "post",
                        data:{"registered": this.registered},  
                        dataType: "json",
                        success : function(data){
                            location.href = "schedule.html";
                        }
                    })
                }
                else{
                    alert("還有參賽者尚未確認喔 ！");
                }
            }
        }
    });

</script>