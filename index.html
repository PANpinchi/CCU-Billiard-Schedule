<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
    <link rel="stylesheet" href="css/billiard.css">
    <title>CCU Billiard</title>
</head>
<body>
    <div id="app">
        <!-- 報名表 -->
        <div class="container minsize" v-show="register_is_display">
            <div style="height: 10vh;"></div>
            <div class="row">
                <div class="col-4">

                </div>
                <div class="col-4" style="text-align: center;">
                    <h1><strong>請輸入參賽者名稱</strong></h1>
                    <div style="height: 2vh;"></div>
                    <input type="text" v-model="player_name" v-on:keyup.enter="onEnter">
                    <div style="height: 4vh;"></div>
                    <ol class="list-group list-group-numbered" style="text-align: left;">
                        <li class="list-group-item" :class="[item.arrColor]" v-for="item in registered" style="font-size: 25px;">
                            <span :class="[item.arrColor]" style="font-size: 25px;"><strong>{{item.name}}</strong></span>
                            <button type="button" class="btn btn-danger" style="float: right" v-if="item.confirm" v-on:click.prevent="remove_item(item)">刪除</button>
                            <button type="button" class="btn btn-success" style="float: right; margin-right: 10px;" v-if="item.confirm" v-on:click.prevent="confirm_item(item)">確認</button>
                            <button type="button" class="btn btn-secondary" style="float: right;" v-else v-on:click.prevent="confirm_item(item)">取消</button>
                        </li>
                    </ol>
                </div>
                <div class="col-4" style="text-align: center;">
                    <h2><strong>賽程表產生器</strong></h2>
                    <hr>
                    <h5 style="color: gray; text-align: left;">
                        <strong>
                            說明：<br>
                            左方輸入參賽者名稱，<br>
                            名字限制至多10個字元，<br>
                            參賽者至多16人，<br>
                            輸入完成後請確認所有參賽者皆完成報名，<br>
                            點擊「產生賽程表」自動生成賽程表。<br><br>
                            賽程表畫面點擊獲勝的參賽者可繼續晉級。<br>
                            綠色：已獲勝的參賽者。<br>
                            紅色：被淘汰的參賽者。<br>
                        </strong>
                    </h5>
                    <div style="height: 5vh"></div>
                    <button type="button" class="btn btn-primary" style="margin-right: 20px;" v-on:click.prevent="submit"><strong>產生賽程表</strong></button>
                    <button type="button" class="btn btn-danger" v-on:click.prevent="remove_All()"><strong>全部刪除</strong></button>
                </div>
            </div>
        </div>

        <!-- 賽程表 -->
        <div class="container minsize" v-show="schedule_is_display">
            <div style="height: 2vh;"></div>
            <div class="row">
                <table class="table table-borderless">
                    <tr>
                        <td v-for="item in promotion4" colspan="16">
                            <div class="border2" :class="[item.status]" v-if="item.status == 0 && item.name != '' && item.name != '空'" style="cursor: pointer;">
                                <p class="content1"><strong>{{item.name}}</strong></p>
                            </div>

                            <div class="border2" :class="[item.status]" v-else>
                                <p class="content1"><strong>{{item.name}}</strong></p>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td v-for="item in promotion3" colspan="8">
                            <div class="border1" :class="[item.status]" v-if="item.status == 0 && item.name != '' && item.name != '空'" style="cursor: pointer;" v-on:click="win(item)">
                                <p class="content1"><strong>{{item.name}}</strong></p>
                            </div>

                            <div class="border1" :class="[item.status]" v-else>
                                <p class="content1"><strong>{{item.name}}</strong></p>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td v-for="item in promotion2" colspan="4">
                            <div class="border1" :class="[item.status]" v-if="item.status == 0 && item.name != '' && item.name != '空'" style="cursor: pointer;" v-on:click="win(item)">
                                <p class="content1"><strong>{{item.name}}</strong></p>
                            </div>

                            <div class="border1" :class="[item.status]" v-else>
                                <p class="content1"><strong>{{item.name}}</strong></p>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td v-for="item in promotion1" colspan="2">
                            <div class="border1" :class="[item.status]" v-if="item.status == 0 && item.name != '' && item.name != '空'" style="cursor: pointer;" v-on:click="win(item)">
                                <p class="content1"><strong>{{item.name}}</strong></p>
                            </div>

                            <div class="border1" :class="[item.status]" v-else>
                                <p class="content1"><strong>{{item.name}}</strong></p>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td v-for="item in registered">
                            <div class="border1" :class="[item.status]" v-if="item.status == 0 && item.name != '' && item.name != '空'" style="cursor: pointer;" v-on:click="win(item)">
                                <p class="content1"><strong>{{item.name}}</strong></p>
                            </div>

                            <div class="border1" :class="[item.status]" v-else>
                                <p class="content1"><strong>{{item.name}}</strong></p>
                            </div>
                        </td>
                    </tr>
                </table>
                <button type="button" class="btn btn-secondary" style="width: 5vw" v-on:click.prevent="back()">返回</button>
            </div>
        </div>
    </div>
</body>
</html>

<script>
    var app = new Vue({
        el: '#app',
        data: {
            player_name: '',
            registered: [],
            // status = 0:未比賽, 'bg-green':贏, 'bg-red':輸
            promotion1: [
                {name: '', status: 0},
                {name: '', status: 0},
                {name: '', status: 0},
                {name: '', status: 0},
                {name: '', status: 0},
                {name: '', status: 0},
                {name: '', status: 0},
                {name: '', status: 0}
            ],
            promotion2: [
                {name: '', status: 0},
                {name: '', status: 0},
                {name: '', status: 0},
                {name: '', status: 0}
            ],
            promotion3: [
                {name: '', status: 0},
                {name: '', status: 0}
            ],
            promotion4: [{name: '', status: 0}],
            register_is_display: true,
            schedule_is_display: false
        },
        methods: {
            onEnter: function(){
                if(this.player_name != ''){
                    if(this.registered.length == 16){
                        alert("已達上限人數 16 人 !");
                        this.player_name = '';
                    }
                    else if (this.player_name.length > 10) {
                        alert("名字不可超過10個字元 !");
                        this.player_name = '';
                    }
                    else{
                        this.registered.push({name: this.player_name, arrColor: 'black', confirm: true, status: 0});
                        this.player_name = '';
                    }
                }
            },

            remove_item: function(item){
                this.registered.splice(this.registered.indexOf(item), 1);
            },

            remove_All: function(item){
                this.registered = [];
            },

            confirm_item: function(item){
                var index = this.registered.indexOf(item);
                this.registered[index].arrColor = this.registered[index].arrColor === 'black' ? 'green' : 'black';
                this.registered[index].confirm = this.registered[index].confirm === true ? false : true;
            },

            back:  function(item){
                location.reload();
            },

            promote1: function(){
                // registered -> promotion1
                for(var i = 0; i < this.registered.length; i++){
                    if(this.registered[i].name == '空' & i % 2 == 0){
                        if(this.registered[i+1].name == '空'){
                            this.registered[i].status = 'bg-red';
                            this.registered[i+1].status = 'bg-red';
                            this.promotion1[Math.floor(i/2)].name = this.registered[i+1].name;
                        }
                        else if(this.registered[i+1].name != ''){
                            this.registered[i].status = 'bg-red';
                            this.registered[i+1].status = 'bg-green';
                            this.promotion1[Math.floor(i/2)].name = this.registered[i+1].name;
                        }
                        i++;
                    }
                    else if(this.registered[i].name == '空' && i % 2 == 1){
                        if(this.registered[i-1].name != ''){
                            this.registered[i].status = 'bg-red';
                            this.registered[i-1].status = 'bg-green';
                            this.promotion1[Math.floor(i/2)].name = this.registered[i-1].name;
                        }
                    }
                }
            },

            promote2: function(){
                // promotion1 -> promotion2
                for(var i = 0; i < this.promotion1.length; i++){
                    if(this.promotion1[i].name == '空' && i % 2 == 0){
                        if(this.promotion1[i+1].name == '空'){
                            this.promotion1[i].status = 'bg-red';
                            this.promotion1[i+1].status = 'bg-red';
                            this.promotion2[Math.floor(i/2)].name = this.promotion1[i+1].name;
                        }
                        else if(this.promotion1[i+1].name != ''){
                            this.promotion1[i].status = 'bg-red';
                            this.promotion1[i+1].status = 'bg-green';
                            this.promotion2[Math.floor(i/2)].name = this.promotion1[i+1].name;
                        }
                        i++;
                    }
                    else if(this.promotion1[i].name == '空' && i % 2 == 1){
                        if(this.promotion1[i-1].name != ''){
                            this.promotion1[i].status = 'bg-red';
                            this.promotion1[i-1].status = 'bg-green';
                            this.promotion2[Math.floor(i/2)].name = this.promotion1[i-1].name;
                        }
                    }
                }
            },

            promote3: function(){
                for(var i = 0; i < this.promotion2.length; i++){
                    if(this.promotion2[i].name == '空' && i % 2 == 0){
                        if(this.promotion2[i+1].name == '空'){
                            this.promotion2[i].status = 'bg-red';
                            this.promotion2[i+1].status = 'bg-red';
                            this.promotion3[Math.floor(i/2)].name = this.promotion2[i+1].name;
                        }
                        else if(this.promotion2[i+1].name != ''){
                            this.promotion2[i].status = 'bg-red';
                            this.promotion2[i+1].status = 'bg-green';
                            this.promotion3[Math.floor(i/2)].name = this.promotion2[i+1].name;
                        }
                        i++;
                    }
                    else if(this.promotion2[i].name == '空' && i % 2 == 1){
                        if(this.promotion2[i-1].name != ''){
                            this.promotion2[i].status = 'bg-red';
                            this.promotion2[i-1].status = 'bg-green';
                            this.promotion3[Math.floor(i/2)].name = this.promotion2[i-1].name;
                        }
                    }
                }
            },

            promote4: function(){
                for(var i = 0; i < this.promotion3.length; i++){
                    if(this.promotion3[i].name == '空' && i % 2 == 0){
                        if(this.promotion3[i+1].name == '空'){
                            this.promotion3[i].status = 'bg-red';
                            this.promotion3[i+1].status = 'bg-red';
                            this.promotion4[Math.floor(i/2)].name = this.promotion3[i+1].name;
                        }
                        else if(this.promotion3[i+1].name != ''){
                            this.promotion3[i].status = 'bg-red';
                            this.promotion3[i+1].status = 'bg-green';
                            this.promotion4[Math.floor(i/2)].name = this.promotion3[i+1].name;
                            this.promotion4[Math.floor(i/2)].status = 'bg-yellow';
                        }
                        i++;
                    }
                    else if(this.promotion3[i].name == '空' && i % 2 == 1){
                        if(this.promotion3[i-1].name != ''){
                            this.promotion3[i].status = 'bg-red';
                            this.promotion3[i-1].status = 'bg-green';
                            this.promotion4[Math.floor(i/2)].name = this.promotion3[i-1].name;
                            this.promotion4[Math.floor(i/2)].status = 'bg-yellow';
                        }
                    }
                }
            },

            win: function(item){
                var index = this.promotion4.indexOf(item);
                var num = 4;
                if(index == -1){
                    index = this.promotion3.indexOf(item);
                    num = 3;
                }
                if(index == -1){
                    index = this.promotion2.indexOf(item);
                    num = 2;
                }
                if(index == -1){
                    index = this.promotion1.indexOf(item);
                    num = 1;
                }
                if(index == -1){
                    index = this.registered.indexOf(item);
                    num = 0;
                }
                
                var check = 0;
                if(num == 3){
                    // 左邊被點擊
                    if(index % 2 == 0){
                        if(this.promotion3[index+1].name != ''){
                            check = 1;
                        }
                    }
                    // 右邊被點擊
                    else{
                        if(this.promotion3[index-1].name != ''){
                            check = 1;
                        }
                    }
                }
                else if(num == 2){
                    // 左邊被點擊
                    if(index % 2 == 0){
                        if(this.promotion2[index+1].name != ''){
                            check = 1;
                        }
                    }
                    // 右邊被點擊
                    else{
                        if(this.promotion2[index-1].name != ''){
                            check = 1;
                        }
                    }
                }
                else if(num == 1){
                    // 左邊被點擊
                    if(index % 2 == 0){
                        if(this.promotion1[index+1].name != ''){
                            check = 1;
                        }
                    }
                    // 右邊被點擊
                    else{
                        if(this.promotion1[index-1].name != ''){
                            check = 1;
                        }
                    }
                }
                else if(num == 0){
                    check = 1;
                }
                
                if(check){
                    var win = confirm("確定是"+item.name+"贏得比賽嗎？");
                }
                else{
                    var win = false;
                }
                
                if(win){
                    if(num == 3){
                        // 左邊勝利
                        if(index % 2 == 0){
                            this.promotion3[index].status = 'bg-green';
                            this.promotion3[index+1].status = 'bg-red';
                        }
                        // 右邊勝利
                        else{
                            this.promotion3[index].status = 'bg-green';
                            this.promotion3[index-1].status = 'bg-red';
                        }
                        
                        this.promotion4[Math.floor(index/2)].name = this.promotion3[index].name;
                        this.promotion4[Math.floor(index/2)].status = 'bg-yellow';
                    }
                    else if(num == 2){
                        // 左邊勝利
                        if(index % 2 == 0){
                            this.promotion2[index].status = 'bg-green';
                            this.promotion2[index+1].status = 'bg-red';
                        }
                        // 右邊勝利
                        else{
                            this.promotion2[index].status = 'bg-green';
                            this.promotion2[index-1].status = 'bg-red';
                        }
                        
                        this.promotion3[Math.floor(index/2)].name = this.promotion2[index].name;

                        /* 若為空則自動晉級 */
                        this.promote4();
                    }
                    else if(num == 1){
                        // 左邊勝利
                        if(index % 2 == 0){
                            this.promotion1[index].status = 'bg-green';
                            this.promotion1[index+1].status = 'bg-red';
                        }
                        // 右邊勝利
                        else{
                            this.promotion1[index].status = 'bg-green';
                            this.promotion1[index-1].status = 'bg-red';
                        }
                        
                        this.promotion2[Math.floor(index/2)].name = this.promotion1[index].name;

                        /* 若為空則自動晉級 */
                        this.promote3();
                        this.promote4();
                    }
                    else if(num == 0){
                        // 左邊勝利
                        if(index % 2 == 0){
                            this.registered[index].status = 'bg-green';
                            this.registered[index+1].status = 'bg-red';
                        }
                        // 右邊勝利
                        else{
                            this.registered[index].status = 'bg-green';
                            this.registered[index-1].status = 'bg-red';
                        }
                        
                        this.promotion1[Math.floor(index/2)].name = this.registered[index].name;

                        /* 若為空則自動晉級 */
                        this.promote2();
                        this.promote3();
                        this.promote4();
                    }
                }
            },

            submit: function(){
                var check_confirm = 1;
                for(var i = 0; i < this.registered.length; i++){
                    if(this.registered[i].confirm == true){
                        check_confirm = 0;
                        break;
                    }
                }

                if(this.registered.length <= 1){
                    alert("請輸入2位以上的參賽者 !");
                }
                else if(check_confirm){
                    /* 顯示賽程表 */
                    this.register_is_display = false;
                    this.schedule_is_display = true;

                    /* 補足16人 */
                    while(this.registered.length < 16){
                        this.registered.push({name: '空', arrColor: 'green', confirm: false, status: 0});
                    }

                    /* 隨機排序 */
                    this.registered.sort(function() {
                        return (0.5-Math.random());
                    });

                    /* 若為空則自動晉級 */
                    // promotion1 -> promotion2
                    this.promote1();

                    // promotion1 -> promotion2
                    this.promote2();

                    // promotion2 -> promotion3
                    this.promote3();

                    // promotion3 -> promotion4
                    this.promote4();
                }
                else{
                    alert("還有參賽者尚未確認喔 ！");
                }
            }
        }
    });

</script>